<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Shopping Cart</title>
    
    <link rel="icon" type="image/png" href="/IMG/LOGO_1-removebg-preview.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#660B05',
                        secondary: '#4E1F00',
                        light: '#fef5f8',
                        dark: '#333333'
                    },
                    boxShadow: {
                        'nav': '0 2px 5px rgba(0, 0, 0, 0.05)',
                        'main-nav': '0 2px 15px rgba(0, 0, 0, 0.05)',
                        'dropdown': '0 15px 30px rgba(0,0,0,0.12)',
                        'card': '0 4px 10px rgba(0,0,0,0.1)',
                        'btn': '0 4px 15px rgba(233, 30, 99, 0.3)'
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }
        .floating { animation: float 6s ease-in-out infinite; }
        .delay-1 { animation-delay: 0.5s; }
        .delay-2 { animation-delay: 1s; }
        .delay-3 { animation-delay: 1.5s; }
        .delay-4 { animation-delay: 2s; }
        :root { --primary: #4E1F00; --secondary: #F5F5DC; }

        .empty-cart {
            background-image: url('https://cdn.dribbble.com/users/5107895/screenshots/14532312/media/a7e6c2e9333d0989e3a54c95dd8321d7.jpg');
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            min-height: 350px;
        }

        .cart-item { transition: transform 0.2s ease, background-color 0.2s ease; }
        .cart-item:hover { background-color: #fafafa; transform: scale(1.01); }
        .quantity-btn { transition: all 0.2s ease; }
        .quantity-btn:hover { background-color: #e5e7eb; }
        .remove-btn:hover { color: #dc2626; transform: translateX(3px); }
        #checkout-btn { background-color: var(--primary); transition: all 0.3s ease; box-shadow: 0 4px 6px -1px rgba(78, 31, 0, 0.3); }
        #checkout-btn:hover { background-color: #3a1800; transform: translateY(-2px); box-shadow: 0 6px 10px -1px rgba(78, 31, 0, 0.4); }
        #item-count { background-color: var(--primary); }
        h1, h2, h3 { color: var(--primary); }
        .cart-item .flex-col.sm\\:flex-row > div:first-child { margin-bottom: 1rem; }
        .cart-item .bg-gray-50 { max-width: 100%; }
        @keyframes slideIn { from { transform: translateX(120%); } to { transform: translateX(0); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-white">

<!-- First Navbar (Top) -->
<nav class="sticky top-0 z-50 flex items-center justify-between px-3 py-2 md:px-8 md:py-6 text-white bg-primary">
    <div class="flex items-center">
        <span class="text-xs sm:text-sm md:text-base">Welcome To The Home Bakery</span>
        <div class="flex flex-col items-center ml-2">
            <div class="relative h-3.5 w-3.5 sm:h-4 sm:w-4 border border-green-600 rounded-sm flex items-center justify-center bg-white">
                <div class="h-1.5 w-1.5 sm:h-2 sm:w-2 bg-green-600 rounded-full"></div>
            </div>
        </div>
    </div>
</nav>

<!-- Second Navbar (Main) -->
<nav class="sticky top-8 sm:top-14 md:top-16 z-40 lg:px-8 bg-white shadow-lg border-b border-gray-100">
    <div class="max-w-7xl mx-auto px-2 sm:px-4 lg:px-8">
        <div class="flex justify-between items-center h-16 sm:h-20 md:h-24">
            <div class="flex-shrink-0">
                <img src="/IMG/nohat_bg_removed_8c9aa728.png" alt="The Home Bakery Logo" class="h-10 w-12 sm:h-12 sm:w-14 md:h-16 md:w-18 transition-transform duration-300 hover:scale-105">
            </div>

            <div class="hidden lg:flex items-center space-x-2">
                <a href="/home.html" class="px-3 py-2 text-base font-medium text-black hover:text-primary hover:bg-gray-50 rounded-lg transition-all duration-200">Home</a>
                <div class="relative group">
                    <a href="#" class="flex items-center px-3 py-2 text-base font-medium text-black hover:text-primary hover:bg-gray-50 rounded-lg transition-all duration-200">
                        Cakes <i class="fas fa-chevron-down ml-1 text-xs transition-transform duration-300 group-hover:rotate-180"></i>
                    </a>
                    <div class="absolute left-1/2 transform -translate-x-1/2 mt-2 w-[250px] bg-white shadow-dropdown rounded-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 z-[100] border border-gray-100">
                        <div class="p-2">
                            <ul class="space-y-1">
                                <li><a href="/CAKES/allcakes.html" class="block px-3 py-2 text-sm text-gray-800 hover:text-primary hover:bg-gray-50 rounded-md">All Cakes</a></li>
                                <li><a href="/CAKES/allcakes.html" class="block px-3 py-2 text-sm text-gray-800 hover:text-primary hover:bg-gray-50 rounded-md">Basic Cakes</a></li>
                                <li><a href="/CAKES/allcakes.html" class="block px-3 py-2 text-sm text-gray-800 hover:text-primary hover:bg-gray-50 rounded-md">Chocolate Cakes</a></li>
                                <li><a href="/CAKES/allcakes.html" class="block px-3 py-2 text-sm text-gray-800 hover:text-primary hover:bg-gray-50 rounded-md">Tea Time Cakes</a></li>
                                <li><a href="/CAKES/allcakes.html" class="block px-3 py-2 text-sm text-gray-800 hover:text-primary hover:bg-gray-50 rounded-md">Premium Cakes</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="relative group">
                    <a href="/PASTRIES/chocopastry.html" class="flex items-center px-3 py-2 text-base font-medium text-black hover:text-primary hover:bg-gray-50 rounded-lg transition-all duration-200">Pastries</a>
                </div>
                <a href="/CUSTOM/custom.html" class="px-3 py-2 text-base font-medium text-black hover:text-primary hover:bg-gray-50 rounded-lg">Customisation</a>
                <a href="/SIDEBY/sideby.html" class="px-3 py-2 text-base font-medium text-black hover:text-primary hover:bg-gray-50 rounded-lg">Crave Corner</a>
                <a href="/MY ORDERS/myorders.html" class="px-3 py-2 text-base font-medium text-black hover:text-primary hover:bg-gray-50 rounded-lg">My Orders</a>
                <a href="../contact.html" class="px-3 py-2 text-base font-medium text-black hover:text-primary hover:bg-gray-50 rounded-lg">Contact Us</a>
                <a href="../about.html" class="px-3 py-2 text-base font-medium text-black hover:text-primary hover:bg-gray-50 rounded-lg">About Us</a>
            </div>

            <div class="flex items-center space-x-1 sm:space-x-2 md:space-x-3 lg:space-x-4">
                <div class="flex items-center space-x-1 sm:space-x-1 md:space-x-1">
                    <a href="#" id="searchToggle" class="relative flex flex-col items-center p-2 text-black hover:text-primary">
                        <i class="fas fa-search text-base sm:text-lg"></i>
                        <span class="hidden sm:block text-xs mt-1">Search</span>
                    </a>
                    <div class="relative flex flex-col items-center p-1 text-black hover:text-primary group">
                        <a href="#" class="flex flex-col items-center">
                            <i class="fas fa-user text-base sm:text-lg"></i>
                            <span class="hidden sm:block text-xs mt-1">Profile</span>
                        </a>
                        <div class="absolute top-full left-1/2 transform -translate-x-1/2 mt-2 border border-[#660B05] w-48 bg-white rounded-md shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50 overflow-hidden">
                            <div class="dropdown-content py-1"></div>
                        </div>
                    </div>
                    <div id="logoutModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 hidden">
                        <div class="bg-white rounded-2xl p-6 max-w-sm w-full mx-5 shadow-2xl text-center">
                            <h3 class="text-xl font-bold text-gray-900 mb-4">Logout?</h3>
                            <p class="text-sm text-gray-600 mb-6">Are you sure you want to logout?</p>
                            <div class="flex justify-center space-x-3">
                                <button id="modalCancel" class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 hover:bg-gray-50 rounded-xl transition-colors">Cancel</button>
                                <button id="modalConfirm" class="px-4 py-2 text-sm font-medium text-white bg-[#660B05] hover:bg-[#4E1F00] rounded-xl transition-colors">Logout</button>
                            </div>
                        </div>
                    </div>
                    <a href="/wishlist.html" class="relative flex flex-col items-center p-0 text-black hover:text-primary">
                        <i class="fas fa-heart text-base sm:text-lg"></i>
                        <span class="hidden sm:block text-xs mt-1">Wishlist</span>
                        <span id="wishlist-count" class="absolute -top-2 -right-1 bg-primary text-white text-[10px] sm:text-xs rounded-full h-4 w-4 sm:h-5 sm:w-5 flex items-center justify-center">0</span>
                    </a>
                </div>
                <a href="/cart.html" class="relative flex flex-col items-center p-1 py-1 px-1 text-black hover:text-primary">
                    <i class="fas fa-shopping-cart text-base sm:text-lg"></i>
                    <span class="hidden sm:block text-xs mt-1">Cart</span>
                    <span id="cart-count" class="absolute -top-1 -right-1 bg-primary text-white text-[10px] sm:text-xs rounded-full h-4 w-4 sm:h-5 sm:w-5 flex items-center justify-center">0</span>
                </a>
                <button id="menuToggle" class="lg:hidden p-2 rounded-md text-gray-700 hover:text-primary hover:bg-gray-50">
                    <i class="fas fa-bars text-lg sm:text-xl"></i>
                </button>
            </div>
        </div>
    </div>

    <div id="navLinks" class="lg:hidden hidden bg-white border-t border-gray-100">
        <div class="px-4 py-4 space-y-2 max-h-[70vh] overflow-y-auto">
            <a href="/home.html" class="block px-4 py-3 text-sm sm:text-base font-medium text-gray-700 hover:text-primary hover:bg-gray-50 rounded-lg">Home</a>
            <div class="space-y-0">
                <button id="mobileCakesToggle" class="w-full flex items-center justify-between px-4 py-3 text-sm sm:text-base font-medium text-gray-700 hover:text-primary hover:bg-gray-50 rounded-lg">
                    Cakes <i class="fas fa-chevron-down text-xs transition-transform duration-300"></i>
                </button>
                <div id="mobileCakesMenu" class="hidden bg-gray-50 border border-gray-200 rounded-lg overflow-hidden mt-1">
                    <div class="p-4 space-y-2">
                        <ul class="space-y-1 text-xs">
                            <li><a href="/CAKES/allcakes.html" class="block px-3 py-2 text-gray-800 hover:text-primary hover:bg-white rounded-md">All Cakes</a></li>
                            <li><a href="/CAKES/allcakes.html" class="block px-3 py-2 text-gray-800 hover:text-primary hover:bg-white rounded-md">Basic Cakes</a></li>
                            <li><a href="/CAKES/allcakes.html" class="block px-3 py-2 text-gray-800 hover:text-primary hover:bg-white rounded-md">Chocolate Cakes</a></li>
                            <li><a href="/CAKES/allcakes.html" class="block px-3 py-2 text-gray-800 hover:text-primary hover:bg-white rounded-md">Tea Time Cakes</a></li>
                            <li><a href="/CAKES/allcakes.html" class="block px-3 py-2 text-gray-800 hover:text-primary hover:bg-white rounded-md">Premium Cakes</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <a href="/PASTRIES/chocopastry.html" class="block px-4 py-3 text-sm sm:text-base font-medium text-gray-700 hover:text-primary hover:bg-gray-50 rounded-lg">Pastries</a>
            <a href="./CUSTOM/custom.html" class="block px-4 py-3 text-sm sm:text-base font-medium text-gray-700 hover:text-primary hover:bg-gray-50 rounded-lg">Customisation</a>
            <a href="/SIDEBY/sideby.html" class="block px-4 py-3 text-sm sm:text-base font-medium text-gray-700 hover:text-primary hover:bg-gray-50 rounded-lg">Crave Corner</a>
            <a href="/MY ORDERS/myorders.html" class="block px-4 py-3 text-sm sm:text-base font-medium text-gray-700 hover:text-primary hover:bg-gray-50 rounded-lg">My Order</a>
            <a href="/contact.html" class="block px-4 py-3 text-sm sm:text-base font-medium text-gray-700 hover:text-primary hover:bg-gray-50 rounded-lg">Contact Us</a>
            <a href="/about.html" class="block px-4 py-3 text-sm sm:text-base font-medium text-gray-700 hover:text-primary hover:bg-gray-50 rounded-lg">About Us</a>
        </div>
    </div>
</nav>

<!-- Search Overlay -->
<div id="searchOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-2 sm:p-4">
    <div class="bg-white rounded-lg p-4 sm:p-6 w-full max-w-sm sm:max-w-md md:max-w-lg transform transition-all duration-300 scale-95 max-h-[90vh] overflow-y-auto">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-base sm:text-lg font-semibold text-gray-800">Search Products</h3>
            <button id="closeSearch" class="text-gray-500 hover:text-gray-700 transition-colors"><i class="fas fa-times text-xl"></i></button>
        </div>
        <div class="mb-4">
            <div class="relative">
                <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                <input type="text" id="searchInput" placeholder="Search for cakes, pastries..." class="w-full pl-10 pr-4 py-3 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary">
            </div>
        </div>
        <div id="searchSuggestions" class="max-h-64 overflow-y-auto scrollbar-hide"></div>
    </div>
</div>

<!-- CART CONTENT -->
<div class="container mx-auto px-4 max-w-6xl py-10">
    <div class="bg-white shadow-xl rounded-2xl p-8 border border-gray-100">
        <h1 class="text-3xl font-extrabold mb-8 flex items-center text-[#660B05]">
            <i class="fas fa-shopping-cart mr-3"></i> Your Shopping Cart
            <span id="item-count" class="ml-3 text-xs font-semibold text-white px-2 py-0.5 bg-[#660B05] rounded-full">0</span>
        </h1>

        <div id="cart-items" class="divide-y divide-gray-100"></div>

        <div id="order-summary" class="bg-gray-50 rounded-xl shadow-inner p-6 mt-6 hidden">
            <h2 class="text-xl font-semibold mb-4 border-b pb-2">Order Summary</h2>
            <div class="flex justify-between mb-3">
                <span class="text-gray-600">Subtotal</span>
                <span id="subtotal" class="font-medium">₹0</span>
            </div>
            <div class="flex justify-between mb-4 border-b pb-4">
                <span class="text-gray-600">Taxes</span>
                <span class="text-sm text-gray-500">Calculated at checkout</span>
            </div>
            <div class="flex justify-between items-center mt-4">
                <h3 class="text-lg font-semibold">Total</h3>
                <p id="cart-total" class="text-2xl font-bold text-primary">₹0</p>
            </div>
        </div>

        <div id="empty-cart-message" class="text-center py-20 hidden">
            <div class="empty-cart mx-auto w-96 h-96"></div>
            <p class="text-2xl font-bold text-gray-700 mb-6">Your cart is empty!</p>
            <a href="/home.html" class="bg-primary text-white px-8 py-4 rounded-xl font-bold hover:bg-secondary transition">Continue Shopping</a>
        </div>

        <div id="cart-actions" class="flex flex-col sm:flex-row gap-4 mt-8 hidden">
            <a href="/home.html" class="flex-1 text-center py-4 border-2 border-primary text-primary rounded-xl font-bold hover:bg-primary hover:text-white transition">Continue Shopping</a>
            <button id="checkout-btn" class="flex-1 py-4 text-white rounded-xl font-bold">Proceed to Checkout →</button>
        </div>
    </div>
</div>

<!-- FOOTER -->
<footer class="bg-white text-gray-800 py-6 px-4 mt-20">
    <div class="max-w-7xl mx-auto">
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 text-center md:text-left">
            <div class="flex flex-col items-center md:items-start">
                <img src="https://thehomebakerypune.com/IMG/nohat_bg_removed_8c9aa728.png" alt="Logo" class="ml-5 mb-5 max-w-20" onerror="this.style.display='none'">
                <p class="text-sm mb-4">We bake happiness into every product.</p>
                <h3 class="text-primary font-bold text-lg mb-2">Follow Us</h3>
                <div class="flex justify-center md:justify-start space-x-3">
                    <a href="https://www.facebook.com/profile.php?id=61557357960651&locale=tl_PH#" target="_blank" class="w-10 h-10 rounded-full bg-primary flex items-center justify-center text-white hover:bg-secondary transition-colors"><i class="fab fa-facebook-f"></i></a>
                    <a href="https://www.instagram.com/the_home_bakery_pune?utm_source=ig_web_button_share_sheet&igsh=ZDNlZDc0MzIxNw==" target="_blank" class="w-10 h-10 rounded-full bg-primary flex items-center justify-center text-white hover:bg-secondary transition-colors"><i class="fab fa-instagram"></i></a>
                    <a href="https://wa.me/919503464162?text=Hi%20The%20Home%20Bakery%2C%20I%20would%20like%20to%20know%20more%20about%20your%20products" target="_blank" class="w-10 h-10 rounded-full bg-primary flex items-center justify-center text-white hover:bg-secondary transition-colors"><i class="fab fa-whatsapp"></i></a>
                </div>
            </div>
            <div class="flex flex-col items-center md:items-start">
                <h3 class="text-primary font-bold text-xl mb-2">Policies</h3>
                <ul class="space-y-1 text-center md:text-left">
                    <li><a href="/POLICIES/disclaimer.html" class="text-sm hover:text-primary transition-colors">Disclaimer</a></li>
                    <li><a href="/POLICIES/privacy.html" class="text-sm hover:text-primary transition-colors">Privacy Policy</a></li>
                    <li><a href="/POLICIES/cancel.html" class="text-sm hover:text-primary transition-colors">Cancellation Policy</a></li>
                    <li><a href="/POLICIES/shipping.html" class="text-sm hover:text-primary transition-colors">Shipping & Delivery Policy</a></li>
                    <li><a href="/POLICIES/refund.html" class="text-sm hover:text-primary transition-colors">Refund & Cancellation Policy</a></li>
                </ul>
            </div>
            <div class="hidden md:block">
                <h3 class="text-primary font-bold text-xl mb-2">Quick Links</h3>
                <ul class="space-y-1">
                    <li><a href="/index.html" class="text-sm hover:text-primary transition-colors">Home</a></li>
                    <li><a href="/CAKES/allcakes.html" class="text-sm hover:text-primary transition-colors">Cakes</a></li>
                    <li><a href="/PASTRIES/chocopastry.html" class="text-sm hover:text-primary transition-colors">Pastries</a></li>
                    <li><a href="/CUSTOM/custom.html" class="text-sm hover:text-primary transition-colors">Customise</a></li>
                    <li><a href="/SIDEBY/sideby.html" class="text-sm hover:text-primary transition-colors">Special Offers</a></li>
                </ul>
            </div>
            <div class="flex flex-col items-center md:items-start">
                <h3 class="text-primary font-bold text-xl mb-2">Contact Us</h3>
                <ul class="space-y-1 text-center md:text-left">
                    <li class="flex items-center justify-center md:justify-start"><i class="fas fa-user mr-3 text-primary text-sm"></i><span class="text-sm font-bold">Anjali Nilesh Pande</span></li>
                    <li class="flex items-start justify-center md:justify-start"><i class="fas fa-map-marker-alt mt-1 mr-3 text-primary text-sm"></i><span class="text-sm">G - 004, ALDEA ESPANOLA PHASE, 6 & 7, opp. Orchid Hotel, Mahalunge, Pune Maharashtra 411045</span></li>
                    <li class="flex items-center justify-center md:justify-start"><i class="fas fa-phone-alt mr-3 text-primary text-sm"></i><span class="text-sm">+91 9537999898</span></li>
                    <li class="flex items-center justify-center md:justify-start"><i class="fas fa-envelope mr-3 text-primary text-sm"></i><span class="text-sm">thehomebakery2020@gmail.com</span></li>
                </ul>
            </div>
        </div>
        <div class="border-t border-gray-300 mt-6 pt-4 text-center">
            <p class="text-sm">© 2025 The Home Bakery. All rights reserved. | GST : 27BAIPD6573J1ZE</p>
        </div>
    </div>
</footer>

<div class="fixed bottom-5 right-5 z-50 flex flex-col space-y-3">
    <button id="scrollToTop" class="w-12 h-12 bg-primary hover:bg-secondary rounded-full shadow-lg flex items-center justify-center text-white transition-all duration-400 transform hover:scale-110 opacity-0 invisible">
        <i class="fas fa-arrow-up text-lg"></i>
    </button>
    <a href="https://wa.me/919503464162" target="_blank" class="w-12 h-12 bg-green-500 hover:bg-green-600 rounded-full shadow-lg flex items-center justify-center text-white transition-all duration-400 transform hover:scale-110">
        <i class="fab fa-whatsapp text-lg"></i>
    </a>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
<script src="./api-service.js"></script>

<script>
// ULTIMATE FINAL SCRIPT — ADDON ORDER LOCKED + CHECKOUT WORKING
const baseImgUrl = "http://localhost:8082";
let cartData = [];

window.showNotification = (msg, type = "success") => {
    Toastify({
        text: msg,
        duration: 1500,
        gravity: "top",
        position: "right",
        style: { background: type === "error" ? "#ef4444" : "#10b981" }
    }).showToast();
};

async function fetchCart() {
    const res = await fetch(`${window.apiService.baseUrl}/cart/get-cart-items?userId=${window.apiService.getUserId()}&t=${Date.now()}`, {
        cache: "no-store"
    });
    return await res.json();
}

function normalizeWithPreservedOrder(rawData) {
    if (!Array.isArray(rawData)) return [];

    return rawData.map(item => {
        const existingItem = cartData.find(i => i.cartItemId === String(item.cartItemId));
        const preservedAddons = existingItem?.addons || [];

        const serverAddonsMap = (item.addons || []).reduce((acc, a) => {
            acc[String(a.id)] = a;
            return acc;
        }, {});

        const finalAddons = preservedAddons.length > 0
            ? preservedAddons.map(old => {
                const serverAddon = serverAddonsMap[old.id];
                if (serverAddon) {
                    return {
                        id: old.id,
                        name: serverAddon.name || old.name,
                        price: Number(serverAddon.price) || old.price,
                        quantity: Number(serverAddon.quantity) || old.quantity,
                        imageUrl: serverAddon.imageUrl?.startsWith("http") ? serverAddon.imageUrl : (serverAddon.imageUrl ? baseImgUrl + serverAddon.imageUrl : old.imageUrl)
                    };
                }
                return old;
            })
            : (item.addons || []).map(a => ({
                id: String(a.id),
                name: a.name || "Addon",
                price: Number(a.price) || 0,
                quantity: Number(a.quantity || 1),
                imageUrl: a.imageUrl?.startsWith("http") ? a.imageUrl : (a.imageUrl ? baseImgUrl + a.imageUrl : "/IMG/addon-placeholder.png")
            }));

        return {
            cartItemId: String(item.cartItemId),
            title: item.title || "Product",
            price: Number(item.price) || 0,
            imageUrl: item.imageUrl?.startsWith("http") ? item.imageUrl : (item.imageUrl ? baseImgUrl + item.imageUrl : "/IMG/placeholder.png"),
            quantity: Number(item.quantity) || 1,
            size: item.size || "Standard",
            addons: finalAddons.filter(a => a.quantity > 0)
        };
    });
}

// Render function (same as before — 100% stable)
function render() {
    const container = document.getElementById("cart-items");
    const empty = document.getElementById("empty-cart-message");
    const actions = document.getElementById("cart-actions");
    const summary = document.getElementById("order-summary");

    if (cartData.length === 0) {
        empty.classList.remove("hidden");
        actions.classList.add("hidden");
        summary.classList.add("hidden");
        document.getElementById("item-count").textContent = "0";
        document.getElementById("cart-count") && (document.getElementById("cart-count").textContent = "0");
        container.innerHTML = "";
        return;
    }

    empty.classList.add("hidden");
    actions.classList.remove("hidden");
    summary.classList.remove("hidden");
    container.innerHTML = "";

    let total = 0;
    const itemCount = cartData.reduce((s, i) => s + i.quantity, 0);
    document.getElementById("item-count").textContent = itemCount;
    document.getElementById("cart-count") && (document.getElementById("cart-count").textContent = itemCount);

    cartData.forEach(item => {
        const addonTotal = item.addons.reduce((s, a) => s + a.price * a.quantity, 0);
        const itemTotal = item.price * item.quantity + addonTotal;
        total += itemTotal;

        const div = document.createElement("div");
        div.className = "py-8 border-b last:border-0";
        div.innerHTML = `
            <div class="flex flex-col md:flex-row gap-6 items-start">
                <img src="${item.imageUrl}" class="w-32 h-32 object-cover rounded-xl border" onerror="this.src='/IMG/placeholder.png'">
                <div class="flex-1">
                    <h3 class="text-2xl font-bold text-primary">${item.title}</h3>
                    <p class="text-gray-600 mt-1">${item.size}</p>

                    ${item.addons.length > 0 ? `
                    <div class="border-2 mt-6 bg-gray-50 rounded-2xl p-6">
                        <p class="font-bold text-lg mb-4">Add-ons</p>
                        ${item.addons.map(a => `
                        <div class="flex items-center justify-between mb-4 pb-4 border-b last:border-0">
                            <div class="flex items-center gap-4">
                                <img src="${a.imageUrl}" class="w-14 h-14 rounded-lg border" onerror="this.src='/IMG/addon-placeholder.png'">
                                <div>
                                    <p class="font-medium">${a.name}</p>
                                    <p class="text-sm text-gray-500">₹${a.price} × ${a.quantity}</p>
                                </div>
                            </div>
                            <div class="flex items-center gap-3">
                                <button onclick="updateAddon('${item.cartItemId}', '${a.id}', -1)" class="w-10 h-10 rounded-full bg-gray-200 hover:bg-gray-300 text-xl">−</button>
                                <span class="w-12 text-center font-bold text-lg">${a.quantity}</span>
                                <button onclick="updateAddon('${item.cartItemId}', '${a.id}', 1)" class="w-10 h-10 rounded-full bg-primary text-white text-xl">+</button>
                            </div>
                        </div>
                        `).join('')}
                    </div>` : ''}

                    <button onclick="removeItem('${item.cartItemId}')" class="mt-6 text-red-600 font-medium hover:text-red-800">Remove Item</button>
                </div>

                <div class="flex flex-col items-end gap-6 w-full md:w-auto">
                    <div class="flex items-center gap-4">
                        <button onclick="updateQty('${item.cartItemId}', -1)" class="w-14 h-14 rounded-full border-2 border-gray-300 hover:bg-gray-100 text-2xl font-bold">−</button>
                        <span class="text-3xl font-bold w-20 text-center">${item.quantity}</span>
                        <button onclick="updateQty('${item.cartItemId}', 1)" class="w-14 h-14 rounded-full bg-primary text-white text-2xl font-bold">+</button>
                    </div>
                    <p class="text-3xl font-bold text-primary">₹${itemTotal.toLocaleString("en-IN")}</p>
                </div>
            </div>
        `;
        container.appendChild(div);
    });

    document.getElementById("subtotal").textContent = "₹" + total.toLocaleString("en-IN");
    document.getElementById("cart-total").textContent = "₹" + total.toLocaleString("en-IN");
}

// Optimistic updates
window.updateQty = async (id, delta) => {
    const item = cartData.find(i => i.cartItemId === id);
    if (!item) return;
    item.quantity = Math.max(1, item.quantity + delta);
    render();
    await syncItem(id);
    showNotification("Quantity updated!");
};

window.updateAddon = async (cartItemId, addonId, delta) => {
    const item = cartData.find(i => i.cartItemId === cartItemId);
    if (!item) return;
    const addon = item.addons.find(a => a.id === addonId);
    if (!addon) return;

    addon.quantity = Math.max(0, addon.quantity + delta);
    if (addon.quantity === 0) {
        item.addons = item.addons.filter(a => a.id !== addonId);
    }
    render();
    await syncItem(cartItemId);
    showNotification(addon.quantity === 0 ? "Addon removed!" : "Addon updated!");
};

window.removeItem = async (id) => {
    await fetch(`${window.apiService.baseUrl}/cart/remove-cart-items`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ userId: window.apiService.getUserId(), cartItemId: Number(id) })
    });
    cartData = cartData.filter(i => i.cartItemId !== id);
    render();
};

async function syncItem(cartItemId) {
    const item = cartData.find(i => i.cartItemId === cartItemId);
    if (!item) return;

    await fetch(`${window.apiService.baseUrl}/cart/update-cart-items`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            userId: window.apiService.getUserId(),
            cartItemId: Number(cartItemId),
            quantity: item.quantity,
            addons: item.addons.map(a => ({ id: Number(a.id), quantity: a.quantity }))
        })
    });

    const fresh = await fetchCart();
    cartData = normalizeWithPreservedOrder(fresh);
    render();
}

// INIT — ONLY ONE TIME
document.addEventListener("DOMContentLoaded", async () => {
    const raw = await fetchCart();
    cartData = normalizeWithPreservedOrder(raw);
    render();

    // CHECKOUT BUTTON FIXED
    const checkoutBtn = document.getElementById("checkout-btn");
    if (checkoutBtn) {
        checkoutBtn.addEventListener("click", () => {
            if (cartData.length > 0) {
                location.href = "/checkout.html";
            } else {
                showNotification("Cart is empty!", "error");
            }
        });
    }
});
</script>

<script src="./index.js"></script>
<script src= "./api-service.js" ></script>
</body>
</html>






<!-- <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Shopping Cart</title>
    <link rel="icon" type="image/png" href="/IMG/LOGO_1-removebg-preview.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#660B05',
                        secondary: '#4E1F00',
                        light: '#fef5f8',
                        dark: '#333333'
                    },
                    boxShadow: {
                        'nav': '0 2px 5px rgba(0, 0, 0, 0.05)',
                        'main-nav': '0 2px 15px rgba(0, 0, 0, 0.05)',
                        'dropdown': '0 15px 30px rgba(0,0,0,0.12)',
                        'card': '0 4px 10px rgba(0,0,0,0.1)',
                        'btn': '0 4px 15px rgba(233, 30, 99, 0.3)'
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        .floating {
            animation: float 6s ease-in-out infinite;
        }
        .delay-1 { animation-delay: 0.5s; }
        .delay-2 { animation-delay: 1s; }
        .delay-3 { animation-delay: 1.5s; }
        .delay-4 { animation-delay: 2s; }
        :root {
          --primary: #4E1F00;
          --secondary: #F5F5DC;
        }

        .empty-cart {
          background-image: url('https://cdn.dribbble.com/users/5107895/screenshots/14532312/media/a7e6c2e9333d0989e3a54c95dd8321d7.jpg');
          background-size: contain;
          background-position: center;
          background-repeat: no-repeat;
          min-height: 350px;
        }

        .cart-item {
          transition: transform 0.2s ease, background-color 0.2s ease;
        }
        .cart-item:hover {
          background-color: #fafafa;
          transform: scale(1.01);
        }

        .quantity-btn {
          transition: all 0.2s ease;
        }

        .quantity-btn:hover {
          background-color: #e5e7eb;
        }

        .remove-btn:hover {
          color: #dc2626;
          transform: translateX(3px);
        }

        #checkout-btn {
          background-color: var(--primary);
          transition: all 0.3s ease;
          box-shadow: 0 4px 6px -1px rgba(78, 31, 0, 0.3);
        }

        #checkout-btn:hover {
          background-color: #3a1800;
          transform: translateY(-2px);
          box-shadow: 0 6px 10px -1px rgba(78, 31, 0, 0.4);
        }

        #item-count {
          background-color: var(--primary);
        }

        h1, h2, h3 {
          color: var(--primary);
        }
    </style>
</head>
<body class="bg-white">

<nav class="sticky top-0 z-50 flex items-center justify-between px-3 py-2 md:px-8 md:py-6 text-white bg-primary">
    <div class="flex items-center">
        <span class="text-xs sm:text-sm md:text-base">Welcome To The Home Bakery</span>
        <div class="flex flex-col items-center ml-2">
          <div class="relative h-3.5 w-3.5 sm:h-4 sm:w-4 border border-green-600 rounded-sm flex items-center justify-center bg-white">
            <div class="h-1.5 w-1.5 sm:h-2 sm:w-2 bg-green-600 rounded-full"></div>
          </div>
        </div>
    </div>
</nav>

<nav class="sticky top-12 sm:top-14 md:top-16 z-40 lg:px-8 bg-white shadow-lg border-b border-gray-100">
    <div class="max-w-7xl mx-auto px-2 sm:px-4 lg:px-8">
        <div class="flex justify-between items-center h-16 sm:h-20 md:h-24">
           
            <div class="flex-shrink-0">
                <img src="/IMG/nohat_bg_removed_8c9aa728.png" alt="The Home Bakery Logo" class="h-10 w-12 sm:h-12 sm:w-14 md:h-16 md:w-18 transition-transform duration-300 hover:scale-105">
            </div>

            <div class="hidden lg:flex items-center space-x-2">
                <a href="/home.html" class="px-3 py-2 text-base font-medium text-black hover:text-primary hover:bg-gray-50 rounded-lg transition-all duration-200">Home</a>
               
                <div class="relative group">
                    <a href="#" class="flex items-center px-3 py-2 text-base font-medium text-black hover:text-primary hover:bg-gray-50 rounded-lg transition-all duration-200">
                        Cakes
                        <i class="fas fa-chevron-down ml-1 text-xs transition-transform duration-300 group-hover:rotate-180"></i>
                    </a>
                    <div class="absolute left-1/2 transform -translate-x-1/2 mt-2 w-[250px] bg-white shadow-dropdown rounded-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 z-[100] border border-gray-100">
                        <div class="p-2">
                            <ul class="space-y-1">
                                <li><a href="/CAKES/allcakes.html" class="block px-3 py-2 text-sm text-gray-800 hover:text-primary hover:bg-gray-50 rounded-md">All Cakes</a></li>
                                <li><a href="/CAKES/allcakes.html" class="block px-3 py-2 text-sm text-gray-800 hover:text-primary hover:bg-gray-50 rounded-md">Basic Cakes</a></li>
                                <li><a href="/CAKES/allcakes.html" class="block px-3 py-2 text-sm text-gray-800 hover:text-primary hover:bg-gray-50 rounded-md">Chocolate Cakes</a></li>
                                <li><a href="/CAKES/allcakes.html" class="block px-3 py-2 text-sm text-gray-800 hover:text-primary hover:bg-gray-50 rounded-md">Tea Time Cakes</a></li>
                                <li><a href="/CAKES/allcakes.html" class="block px-3 py-2 text-sm text-gray-800 hover:text-primary hover:bg-gray-50 rounded-md">Premium Cakes</a></li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="relative group">
                    <a href="/PASTRIES/chocopastry.html" class="flex items-center px-3 py-2 text-base font-medium text-black hover:text-primary hover:bg-gray-50 rounded-lg transition-all duration-200">
                        Pastries
                    </a>
                </div>

                <a href="/CUSTOM/custom.html" class="px-3 py-2 text-base font-medium text-black hover:text-primary hover:bg-gray-50 rounded-lg">Customisation</a>
                <a href="/SIDEBY/sideby.html" class="px-3 py-2 text-base font-medium text-black hover:text-primary hover:bg-gray-50 rounded-lg">Crave Corner</a>
                <a href="/MY ORDERS/myorders.html" class="px-3 py-2 text-base font-medium text-black hover:text-primary hover:bg-gray-50 rounded-lg">My Orders</a>
                <a href="../contact.html" class="px-3 py-2 text-base font-medium text-black hover:text-primary hover:bg-gray-50 rounded-lg">Contact Us</a>
                <a href="../about.html" class="px-3 py-2 text-base font-medium text-black hover:text-primary hover:bg-gray-50 rounded-lg">About Us</a>
            </div>

            <div class="flex items-center space-x-1 sm:space-x-2 md:space-x-3 lg:space-x-4">
                <div class="flex items-center space-x-1 sm:space-x-1 md:space-x-1">
                    <a href="#" id="searchToggle" class="relative flex flex-col items-center p-2 text-black hover:text-primary">
                        <i class="fas fa-search text-base sm:text-lg"></i>
                        <span class="hidden sm:block text-xs mt-1">Search</span>
                    </a>
           
                    <div class="relative flex flex-col items-center p-1 text-black hover:text-primary group">
                        <a href="#" class="flex flex-col items-center">
                            <i class="fas fa-user text-base sm:text-lg"></i>
                           <span class="hidden sm:block text-xs mt-1">Profile</span>
                        </a>
                       
                        <div class="absolute top-full left-1/2 transform -translate-x-1/2 mt-2 border border-[#660B05] w-48 bg-white rounded-md shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50 overflow-hidden">
                            <div class="dropdown-content py-1">
                            </div>
                        </div>
                    </div>

                    <div id="logoutModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 hidden">
                        <div class="bg-white rounded-2xl p-6 max-w-sm w-full mx-5 shadow-2xl text-center">
                            <h3 class="text-xl font-bold text-gray-900 mb-4">Logout?</h3>
                            <p class="text-sm text-gray-600 mb-6">Are you sure you want to logout?</p>
                            <div class="flex justify-center space-x-3">
                                <button id="modalCancel" class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 hover:bg-gray-50 rounded-xl transition-colors">Cancel</button>
                                <button id="modalConfirm" class="px-4 py-2 text-sm font-medium text-white bg-[#660B05] hover:bg-[#4E1F00] rounded-xl transition-colors">Logout</button>
                            </div>
                        </div>
                    </div>

                    <a href="/wishlist.html" class="relative flex flex-col items-center p-0 text-black hover:text-primary">
                        <i class="fas fa-heart text-base sm:text-lg"></i>
                        <span class="hidden sm:block text-xs mt-1">Wishlist</span>
                        <span id="wishlist-count" class="absolute -top-2 -right-1 bg-primary text-white text-[10px] sm:text-xs rounded-full h-4 w-4 sm:h-5 sm:w-5 flex items-center justify-center">0</span>
                    </a>
                </div>

                <a href="/cart.html" class="relative flex flex-col items-center p-1 py-1 px-1 text-black hover:text-primary">
                    <i class="fas fa-shopping-cart text-base sm:text-lg"></i>
                    <span class="hidden sm:block text-xs mt-1">Cart</span>
                    <span id="cart-count" class="absolute -top-1 -right-1 bg-primary text-white text-[10px] sm:text-xs rounded-full h-4 w-4 sm:h-5 sm:w-5 flex items-center justify-center">0</span>
                </a>
                
                <button id="menuToggle" class="lg:hidden p-2 rounded-md text-gray-700 hover:text-primary hover:bg-gray-50">
                    <i class="fas fa-bars text-lg sm:text-xl"></i>
                </button>
            </div>
        </div>
    </div>

    <div id="navLinks" class="lg:hidden hidden bg-white border-t border-gray-100">
        <div class="px-4 py-4 space-y-2 max-h-[70vh] overflow-y-auto">
            <a href="/home.html" class="block px-4 py-3 text-sm sm:text-base font-medium text-gray-700 hover:text-primary hover:bg-gray-50 rounded-lg">Home</a>
           
            <div class="space-y-0">
                <button id="mobileCakesToggle" class="w-full flex items-center justify-between px-4 py-3 text-sm sm:text-base font-medium text-gray-700 hover:text-primary hover:bg-gray-50 rounded-lg">
                    Cakes
                    <i class="fas fa-chevron-down text-xs transition-transform duration-300"></i>
                </button>
                <div id="mobileCakesMenu" class="hidden bg-gray-50 border border-gray-200 rounded-lg overflow-hidden mt-1">
                    <div class="p-4 space-y-2">
                        <ul class="space-y-1 text-xs">
                            <li><a href="/CAKES/allcakes.html" class="block px-3 py-2 text-gray-800 hover:text-primary hover:bg-white rounded-md">All Cakes</a></li>
                            <li><a href="/CAKES/allcakes.html" class="block px-3 py-2 text-gray-800 hover:text-primary hover:bg-white rounded-md">Basic Cakes</a></li>
                            <li><a href="/CAKES/allcakes.html" class="block px-3 py-2 text-gray-800 hover:text-primary hover:bg-white rounded-md">Chocolate Cakes</a></li>
                            <li><a href="/CAKES/allcakes.html" class="block px-3 py-2 text-gray-800 hover:text-primary hover:bg-white rounded-md">Tea Time Cakes</a></li>
                            <li><a href="/CAKES/allcakes.html" class="block px-3 py-2 text-gray-800 hover:text-primary hover:bg-white rounded-md">Premium Cakes</a></li>
                        </ul>
                    </div>
                </div>
            </div>
   
            <a href="/PASTRIES/chocopastry.html" class="block px-4 py-3 text-sm sm:text-base font-medium text-gray-700 hover:text-primary hover:bg-gray-50 rounded-lg">Pastries</a>
            <a href="./CUSTOM/custom.html" class="block px-4 py-3 text-sm sm:text-base font-medium text-gray-700 hover:text-primary hover:bg-gray-50 rounded-lg">Customisation</a>
            <a href="/SIDEBY/sideby.html" class="block px-4 py-3 text-sm sm:text-base font-medium text-gray-700 hover:text-primary hover:bg-gray-50 rounded-lg">Crave Corner</a>
            <a href="/MY ORDERS/myorders.html" class="block px-4 py-3 text-sm sm:text-base font-medium text-gray-700 hover:text-primary hover:bg-gray-50 rounded-lg">My Order</a>
            <a href="/contact.html" class="block px-4 py-3 text-sm sm:text-base font-medium text-gray-700 hover:text-primary hover:bg-gray-50 rounded-lg">Contact Us</a>
            <a href="/about.html" class="block px-4 py-3 text-sm sm:text-base font-medium text-gray-700 hover:text-primary hover:bg-gray-50 rounded-lg">About Us</a>
        </div>
    </div>
</nav>

<div id="deliveryModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
    <div class="bg-white rounded-lg p-4 sm:p-6 w-full max-w-md transform transition-all duration-300 scale-95 max-h-[90vh] overflow-y-auto">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-base sm:text-lg font-semibold text-gray-800">Choose Delivery Location</h3>
            <button id="closeModal" class="text-gray-500 hover:text-gray-700 transition-colors">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
       
        <div class="mb-4">
            <div class="relative">
                <i class="fas fa-map-marker-alt absolute left-3 top-3 text-gray-400"></i>
                <input type="text" id="locationInput" placeholder="Enter your area, city or pincode" class="w-full pl-10 pr-4 py-3 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary">
            </div>
            <div id="locationError" class="text-red-500 text-xs sm:text-sm mt-1 hidden"></div>
            <div id="locationSuccess" class="text-green-500 text-xs sm:text-sm mt-1 hidden"></div>
        </div>
        <div class="mb-4">
            <h4 class="text-xs sm:text-sm font-medium text-gray-700 mb-2">Popular Areas in Pune</h4>
            <div class="grid grid-cols-2 gap-2 max-h-48 overflow-y-auto">
                <button class="location-option text-left p-2 rounded-lg hover:bg-gray-100 transition-colors text-xs sm:text-sm">
                    <i class="fas fa-map-pin text-primary mr-2"></i>Koregaon Park
                </button>
                <button class="location-option text-left p-2 rounded-lg hover:bg-gray-100 transition-colors text-xs sm:text-sm">
                    <i class="fas fa-map-pin text-primary mr-2"></i>Baner
                </button>
                <button class="location-option text-left p-2 rounded-lg hover:bg-gray-100 transition-colors text-xs sm:text-sm">
                    <i class="fas fa-map-pin text-primary mr-2"></i>Wakad
                </button>
                <button class="location-option text-left p-2 rounded-lg hover:bg-gray-100 transition-colors text-xs sm:text-sm">
                    <i class="fas fa-map-pin text-primary mr-2"></i>Hinjewadi
                </button>
            </div>
        </div>
        <button id="confirmLocation" class="w-full bg-gradient-to-r from-primary to-secondary text-white py-3 rounded-lg text-sm sm:text-base font-medium hover:from-secondary hover:to-primary transition-all duration-300 disabled:opacity-50" disabled>
            Confirm Location
        </button>
    </div>
</div>

<div id="searchOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-2 sm:p-4">
    <div class="bg-white rounded-lg p-4 sm:p-6 w-full max-w-sm sm:max-w-md md:max-w-lg transform transition-all duration-300 scale-95 max-h-[90vh] overflow-y-auto">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-base sm:text-lg font-semibold text-gray-800">Search Products</h3>
            <button id="closeSearch" class="text-gray-500 hover:text-gray-700 transition-colors">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
       
        <div class="mb-4">
            <div class="relative">
                <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                <input type="text" id="searchInput" placeholder="Search for cakes, pastries..." class="w-full pl-10 pr-4 py-3 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary">
            </div>
        </div>
       
        <div id="searchSuggestions" class="max-h-64 overflow-y-auto scrollbar-hide"></div>
    </div>
</div>

<div class="container mx-auto px-4 max-w-6xl">
    <div class="bg-white shadow-xl rounded-2xl p-8 border border-gray-100">
        <h1 class="text-3xl font-extrabold mb-8 flex items-center text-[#660B05]">
            <i class="fas fa-shopping-cart mr-3 text-[#660B05]"></i>
            Your Shopping Cart
            <span id="item-count" class="ml-3 text-xs font-semibold text-white px-2 py-0.5 bg-[#660B05] rounded-full">0</span>
        </h1>

        <div id="cart-container">
            <div id="cart-items" class="divide-y divide-gray-100"></div>

            <div id="order-summary" class="bg-gray-50 rounded-xl shadow-inner p-6 mt-6 hidden">
                <h2 class="text-xl font-semibold mb-4 border-b pb-2">Order Summary</h2>
                <div class="flex justify-between mb-3">
                    <span class="text-gray-600">Subtotal</span>
                    <span id="subtotal" class="font-medium">₹0</span>
                </div>
                <div class="flex justify-between mb-4 border-b pb-4">
                    <span class="text-gray-600">Taxes</span>
                    <span class="text-sm text-gray-500">Calculated at checkout</span>
                </div>
                <div class="flex justify-between items-center mt-4">
                    <h3 class="text-lg font-semibold">Total</h3>
                    <p id="cart-total" class="text-2xl font-bold text-[var(--primary)]">₹0</p>
                </div>
            </div>
        </div>

        <div id="empty-cart-message" class="empty-cart text-center py-8 hidden">
            <p class="text-gray-700 text-lg mb-4">Your cart is feeling light!</p>
            <a href="home.html" class="mt-6 inline-block bg-[#660B05] hover:bg-[#660B05] text-white px-6 py-3 rounded-lg font-medium transition-transform transform hover:-translate-x-1">
                <i class="fas fa-arrow-left mr-2"></i> Continue Shopping
            </a>
        </div>

        <div id="cart-actions" class="flex flex-col sm:flex-row justify-between gap-4 mt-8 hidden">
            <a href="home.html" class="px-6 py-3 border border-gray-300 rounded-xl text-[var(--primary)] hover:bg-gray-50 transition flex items-center justify-center">
                <i class="fas fa-arrow-left mr-2"></i> Continue Shopping
            </a>
            <button id="checkout-btn" class="px-6 py-3 text-white rounded-xl font-medium transition flex items-center justify-center">
                Proceed to Checkout <i class="fas fa-arrow-right ml-2"></i>
            </button>
        </div>
    </div>
</div>

<footer class="bg-white text-gray-800 py-6 px-4">
  <div class="max-w-7xl mx-auto">
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 text-center md:text-left">
     
      <div class="flex flex-col items-center md:items-start">
        <img src="https://thehomebakerypune.com/IMG/nohat_bg_removed_8c9aa728.png" alt="The Home Bakery Logo" class="ml-5 mb-5 max-w-20" onerror="this.style.display='none'">
        <p class="text-sm mb-4">We bake happiness into every product.</p>
       
        <h3 class="text-primary font-bold text-lg mb-2">Follow Us</h3>
        <div class="flex justify-center md:justify-start space-x-3">
          <a href="https://www.facebook.com/profile.php?id=61557357960651&locale=tl_PH#" target="_blank" class="w-10 h-10 rounded-full bg-primary flex items-center justify-center text-white hover:bg-secondary transition-colors">
            <i class="fab fa-facebook-f"></i>
          </a>
          <a href="https://www.instagram.com/the_home_bakery_pune?utm_source=ig_web_button_share_sheet&igsh=ZDNlZDc0MzIxNw==" target="_blank" class="w-10 h-10 rounded-full bg-primary flex items-center justify-center text-white hover:bg-secondary transition-colors">
            <i class="fab fa-instagram"></i>
          </a>
          <a href="https://wa.me/919503464162?text=Hi%20The%20Home%20Bakery%2C%20I%20would%20like%20to%20know%20more%20about%20your%20products" target="_blank" class="w-10 h-10 rounded-full bg-primary flex items-center justify-center text-white hover:bg-secondary transition-colors">
            <i class="fab fa-whatsapp"></i>
          </a>
        </div>
      </div>

      <div class="flex flex-col items-center md:items-start">
        <h3 class="text-primary font-bold text-xl mb-2">Policies</h3>
        <ul class="space-y-1 text-center md:text-left">
          <li><a href="/POLICIES/disclaimer.html" class="text-sm hover:text-primary transition-colors">Disclaimer</a></li>
          <li><a href="/POLICIES/privacy.html" class="text-sm hover:text-primary transition-colors">Privacy Policy</a></li>
          <li><a href="/POLICIES/cancel.html" class="text-sm hover:text-primary transition-colors">Cancellation Policy</a></li>
          <li><a href="/POLICIES/shipping.html" class="text-sm hover:text-primary transition-colors">Shipping & Delivery Policy</a></li>
          <li><a href="/POLICIES/refund.html" class="text-sm hover:text-primary transition-colors">Refund & Cancellation Policy</a></li>
        </ul>
      </div>

      <div class="hidden md:block">
        <h3 class="text-primary font-bold text-xl mb-2">Quick Links</h3>
        <ul class="space-y-1">
          <li><a href="/index.html" class="text-sm hover:text-primary transition-colors">Home</a></li>
          <li><a href="/CAKES/allcakes.html" class="text-sm hover:text-primary transition-colors">Cakes</a></li>
          <li><a href="/PASTRIES/chocopastry.html" class="text-sm hover:text-primary transition-colors">Pastries</a></li>
          <li><a href="/CUSTOM/custom.html" class="text-sm hover:text-primary transition-colors">Customise</a></li>
          <li><a href="/SIDEBY/sideby.html" class="text-sm hover:text-primary transition-colors">Special Offers</a></li>
        </ul>
      </div>

      <div class="flex flex-col items-center md:items-start">
        <h3 class="text-primary font-bold text-xl mb-2">Contact Us</h3>
        <ul class="space-y-1 text-center md:text-left">
          <li class="flex items-center justify-center md:justify-start">
            <i class="fas fa-user mr-3 text-primary text-sm"></i>
            <span class="text-sm font-bold">Anjali Nilesh Pande</span>
          </li>
          <li class="flex items-start justify-center md:justify-start">
            <i class="fas fa-map-marker-alt mt-1 mr-3 text-primary text-sm"></i>
            <span class="text-sm">G - 004, ALDEA ESPANOLA PHASE, 6 & 7, opp. Orchid Hotel, Mahalunge, Pune Maharashtra 411045</span>
          </li>
          <li class="flex items-center justify-center md:justify-start">
            <i class="fas fa-phone-alt mr-3 text-primary text-sm"></i>
            <span class="text-sm">+91 9537999898</span>
          </li>
          <li class="flex items-center justify-center md:justify-start">
            <i class="fas fa-envelope mr-3 text-primary text-sm"></i>
            <span class="text-sm">thehomebakery2020@gmail.com</span>
          </li>
        </ul>
      </div>
    </div>
    <div class="border-t border-gray-300 mt-6 pt-4 text-center">
      <p class="text-sm">© 2025 The Home Bakery. All rights reserved. | GST : 27BAIPD6573J1ZE</p>
    </div>
  </div>
</footer>

<div class="fixed bottom-5 right-5 z-50 flex flex-col space-y-3">
    <button id="scrollToTop" class="w-12 h-12 bg-primary hover:bg-secondary rounded-full shadow-lg flex items-center justify-center text-white transition-all duration-400 transform hover:scale-110 opacity-0 invisible">
        <i class="fas fa-arrow-up text-lg"></i>
    </button>
    <a href="https://wa.me/919503464162" target="_blank" class="w-12 h-12 bg-green-500 hover:bg-green-600 rounded-full shadow-lg flex items-center justify-center text-white transition-all duration-400 transform hover:scale-110">
        <i class="fab fa-whatsapp text-lg"></i>
    </a>
</div>

<script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
<script src="./api-service.js"></script>

<script>
    const baseImgUrl = "https://api.thehomebakerypune.com";
    let cart = [];
    let apiService = null;

    function initializeApiService() {
        return new Promise(resolve => {
            const check = () => {
                if (window.apiService) {
                    apiService = window.apiService;
                    resolve();
                } else {
                    setTimeout(check, 100);
                }
            };
            check();
        });
    }

    function showNotification(message, type = 'info') {
        const bg = type === 'success' ? '#10B981' : type === 'error' ? '#EF4444' : '#3B82F6';
        Toastify({
            text: message,
            duration: 3000,
            backgroundColor: bg,
            position: "right",
            gravity: "top"
        }).showToast();
    }

    function getProductImageUrl(imageUrl) {
        if (!imageUrl) return '';
        return imageUrl.startsWith('http') ? imageUrl : `${baseImgUrl}${imageUrl}`;
    }

    window.removeItem = async function(cartItemId) {
        if (!apiService) return showNotification('Service not ready', 'error');
        const userId = apiService.getUserId();
        if (!userId) return showNotification('Login required', 'error');

        try {
            const response = await fetch(`${apiService.baseUrl}/cart/remove-cart-items`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    userId: Number(userId),
                    cartItemId: Number(cartItemId)
                })
            });

            if (!response.ok) {
                const errorText = await response.text();
                throw new Error(errorText || 'Remove failed');
            }

            const text = await response.text();
            showNotification('Item removed!', 'success');
            renderCart();
        } catch (err) {
            console.error('Remove error:', err);
            showNotification('Remove failed: ' + err.message, 'error');
        }
    };

    window.updateQty = async function(cartItemId, change) {
        if (!apiService) return showNotification('Service not ready', 'error');
        const userId = apiService.getUserId();
        if (!userId) return showNotification('Login required', 'error');

        const item = cart.find(i => i.cartItemId === cartItemId);
        if (!item) return;

        const newQty = item.quantity + change;
        if (newQty <= 0) return removeItem(cartItemId);

        try {
            const response = await fetch(`${apiService.baseUrl}/cart/update-cart-items`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    userId: Number(userId),
                    cartItemId: Number(cartItemId),
                    quantity: newQty
                })
            });

            if (!response.ok) {
                const errorText = await response.text();
                throw new Error(errorText || 'Update failed');
            }

            showNotification('Quantity updated!', 'success');
            renderCart();
        } catch (err) {
            console.error('Update error:', err);
            showNotification('Update failed: ' + err.message, 'error');
        }
    };

    async function renderCart() {
        if (!apiService) await initializeApiService();
        const container = document.getElementById('cart-items');
        const empty = document.getElementById('empty-cart-message');
        const actions = document.getElementById('cart-actions');
        const summary = document.getElementById('order-summary');
        const countEl = document.getElementById('item-count');
        let data = [];

        try { 
            data = await apiService.getCart(); 
        } catch (e) { console.error(e); }

        cart = Array.isArray(data) ? data.map(item => {
            const isSnack = item.itemType === 'SNACK';
            return {
                cartItemId: String(item.cartItemId),
                id: String(isSnack ? item.snackId : item.productId),
                itemType: item.itemType,
                name: item.title,
                price: Number(item.price),
                image: getProductImageUrl(item.imageUrl),
                quantity: Number(item.quantity),
                size: item.size ,
                addons: (item.addons || []).map(a => ({ 
                    id: String(a.id), 
                    name: a.name, 
                    price: Number(a.price), 
                    image: getProductImageUrl(a.imageUrl) 
                }))
            };
        }) : [];

        const totalItems = cart.reduce((sum, i) => sum + i.quantity, 0);

        if (cart.length === 0) {
            empty.classList.remove('hidden'); 
            actions.classList.add('hidden'); 
            summary.classList.add('hidden');
            countEl.textContent = '0'; 
            return;
        }

        empty.classList.add('hidden'); 
        actions.classList.remove('hidden'); 
        summary.classList.remove('hidden');
        container.innerHTML = '';
        let subtotal = 0;

        cart.forEach(item => {
            const itemTotal = (item.price + item.addons.reduce((s, a) => s + a.price, 0)) * item.quantity;
            subtotal += itemTotal;

            const el = document.createElement('div');
            el.className = 'cart-item flex flex-col sm:flex-row justify-between items-start sm:items-center py-6 px-4 border-b';
            el.innerHTML = `
                <div class="flex items-start w-full sm:w-2/3 mb-4 sm:mb-0">
                    <img src="${item.image}" alt="${item.name}" class="w-20 h-20 object-cover rounded-xl mr-4 shadow-sm border ${!item.image ? 'hidden' : ''}" onerror="this.classList.add('hidden')">
                    <div class="flex-1">
                        <h3 class="font-medium text-lg text-[#660B05]">${item.name}</h3>
                        <p class="text-sm text-gray-500">${item.size} • ${item.itemType}</p>
                        ${item.addons.length > 0 ? `<div class="mt-2"><p class="text-sm font-medium text-gray-600">Add-ons:</p><ul class="ml-4 list-disc text-sm text-gray-500">${item.addons.map(a => `<li>${a.name} - ₹${a.price}</li>`).join('')}</ul></div>` : ''}
                        <button onclick="removeItem('${item.cartItemId}')" class="mt-3 text-red-500 hover:text-red-700 text-sm flex items-center">
                            <i class="fas fa-trash mr-1"></i> Remove
                        </button>
                    </div>
                </div>
                <div class="flex flex-col sm:flex-row items-end sm:items-center justify-between w-full sm:w-1/3 gap-3">
                    <div class="flex items-center">
                        <button onclick="updateQty('${item.cartItemId}', -1)" class="quantity-btn px-3 py-1 border border-gray-300 rounded-l hover:bg-gray-100 text-lg">−</button>
                        <span class="px-4 py-1 border-t border-b border-gray-300 bg-gray-50 min-w-[50px] text-center font-medium">${item.quantity}</span>
                        <button onclick="updateQty('${item.cartItemId}', 1)" class="quantity-btn px-3 py-1 border border-gray-300 rounded-r hover:bg-gray-100 text-lg">+</button>
                    </div>
                    <div class="text-right">
                        <p class="text-lg font-semibold text-[#660B05]">₹${itemTotal.toLocaleString('en-IN')}</p>
                    </div>
                </div>
            `;
            container.appendChild(el);
        });

        document.getElementById('subtotal').textContent = `₹${subtotal.toLocaleString('en-IN')}`;
        document.getElementById('cart-total').textContent = `₹${(subtotal).toLocaleString('en-IN')}`;
        countEl.textContent = totalItems;
    }

    document.addEventListener('DOMContentLoaded', async () => {
        await initializeApiService();
        await renderCart();

        document.getElementById('checkout-btn')?.addEventListener('click', () => {
            if (cart.length > 0) {
                window.location.href = '/checkout.html';
            } else {
                showNotification('Your cart is empty!', 'error');
            }
        });
    });
</script>

<script>
(() => {
    const searchToggle   = document.getElementById('searchToggle');
    const searchOverlay  = document.getElementById('searchOverlay');
    const closeSearch    = document.getElementById('closeSearch');

    const profileToggle  = document.querySelector('.group > a[href="#"]');
    const profileDropdown= document.querySelector('.group .dropdown-content');

    if (searchToggle && searchOverlay) {
        searchToggle.addEventListener('click', e => {
            e.preventDefault();
            searchOverlay.classList.remove('hidden');
            document.getElementById('searchInput')?.focus();
        });
    }
    if (closeSearch && searchOverlay) {
        closeSearch.addEventListener('click', () => {
            searchOverlay.classList.add('hidden');
        });
    }
    searchOverlay?.addEventListener('click', e => {
        if (e.target === searchOverlay) searchOverlay.classList.add('hidden');
    });

    if (profileToggle && profileDropdown) {
        const openDropdown = () => profileDropdown.parentElement.classList.remove('opacity-0','invisible');
        const closeDropdown = () => profileDropdown.parentElement.classList.add('opacity-0','invisible');

        profileToggle.parentElement.addEventListener('mouseenter', openDropdown);
        profileToggle.parentElement.addEventListener('mouseleave', closeDropdown);

        profileToggle.addEventListener('click', e => {
            e.preventDefault();
            const wrapper = profileDropdown.parentElement;
            wrapper.classList.toggle('opacity-0');
            wrapper.classList.toggle('invisible');
        });
    }

    const originalRemove = window.removeItem;
    const originalUpdate = window.updateQty;

    const clearCartLS = () => {
        Object.keys(localStorage).forEach(k => {
            if (k.includes('cart') || k.includes('Cart')) localStorage.removeItem(k);
        });
    };

    window.removeItem = async function(cartItemId) {
        try {
            await originalRemove(cartItemId);
        } finally {
            clearCartLS();
            location.reload();
        }
    };

    window.updateQty = async function(cartItemId, change) {
        try {
            await originalUpdate(cartItemId, change);
        } finally {
            clearCartLS();
            location.reload();
        }
    };

    document.addEventListener('keydown', e => {
        if (e.key === 'Escape') {
            searchOverlay?.classList.add('hidden');
            document.getElementById('deliveryModal')?.classList.add('hidden');
        }
    });
})();
</script>
<script src="./index.js"></script>
</body>
</html> -->